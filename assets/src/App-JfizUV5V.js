import{r,u as fe,F as pe,a as me,j as t,Z as we,b as ye,C as ve,c as he,P as ge,d as xe,e as ke,S as Ee,f as be,X as je}from"../vendor-6J9SHA5K.js";import{C as Se}from"./components/controls/control_panel-DnFaRLSF.js";import{G as Le}from"./components/controls/glyph_preview-BhMbGkwP.js";import{u as n,a as Ce}from"./lib/timeline_state-Dw4tu5kw.js";import{f as j}from"./logic/ffmpeg_service-DG8B1FDT.js";import{p as De,g as Ke,r as Ae}from"./logic/export_logic-zYbLsDjC.js";import{B as Y}from"./components/ui/button-DBlz7T_2.js";import{I as Pe}from"./components/timeline/instructions-CMAXHcZX.js";import{S as Fe}from"./components/controls/save_dialog-CApeTbea.js";import{T as Ie}from"./components/ui/sonner-CvWlkB0w.js";import{d}from"./lib/data_store-DFUoucx7.js";import{F as Te}from"./components/ui/fullScreenLoader-BCZNZLRB.js";import{s as S}from"./lib/helpers-CGQdiVDq.js";import{E as Ne}from"./components/timeline/editor-D9zMHfDn.js";function ze(){r.useEffect(()=>{function e(i){return i.preventDefault(),""}return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}},[]);const L=n(e=>e.items),C=n(e=>e.reset),h=n(e=>e.updateAudioDuration),q=n(e=>e.phoneModel),D=n(e=>e.appSettings.isKeyboardGestureEnabled),K=n(e=>e.removeSelectedItem),g=n(e=>e.toggleMultiSelect),A=n(e=>e.selectAll),z=n(e=>e.importJsonData),P=n(e=>e.copyItems),F=n(e=>e.cutItems),I=n(e=>e.pasteItems),H=n(e=>e.increasePixelFactor),Q=n(e=>e.decreasePixelFactor),T=n(e=>e.appSettings.timelinePixelFactor),{undo:x,redo:k,pastStates:N,futureStates:G,clear:_}=Ce(e=>e),m=r.useRef(null),[a,E]=r.useState(!1),{openFilePicker:ee,filesContent:w,errors:c,plainFiles:u,clear:R}=fe({readFilesContent:!0,readAs:"DataURL",accept:"audio/*",multiple:!1,validators:[new pe(["mp3","ogg"])]}),{load:te,stop:oe,togglePlayPause:ne,play:Z,pause:M,setRate:ie,duration:l,seek:b,playing:y}=me();r.useEffect(()=>{var i;async function e(s){const f=await j.getGlyphData(s);if(f){const p=Ae(f);p&&z(JSON.stringify(p))}}if(w.length>0&&((i=w[0])!=null&&i.content))try{te(w[0].content,{format:"mp3"}),E(!0),h(l*1e3),d.set("isAudioLoaded",!0),u[0]&&u[0].type==="audio/ogg"&&(S("Trying to extract Glyph Data","Working in background to get data",2500),e(u[0])),ie(d.get("audioSpeed")??1),_();return}catch(s){console.error("Error while loading audio file:",s)}else c.length>0&&(console.error("Error while selecting audio file:",c),alert(`File error.
Error while loading input audio file, possible file format mismatch.`));a&&(E(!1),d.set("isAudioLoaded",!1))},[w,c]),c.length&&console.error(`Failed to pick file: ${c}`),r.useEffect(()=>{h(l*1e3)},[l,h]);const[se,re]=r.useState(!1),[v,J]=r.useState(!1);if(r.useEffect(()=>{async function e(){await j.load(),re(!0)}e()},[]),r.useEffect(()=>{function e(o){o.code==="Space"&&(y?M():Z(),o.preventDefault())}function i(o){(o.code==="Delete"||o.code==="Backspace"&&!d.get("isMoreMenuOpen"))&&K()}function s(o){o.shiftKey&&g(!0)}function f(o){o.key==="Shift"&&g(!1)}function p(o){(o.ctrlKey||o.metaKey)&&o.code==="KeyA"&&(A(),o.preventDefault())}function B(o){(o.ctrlKey||o.metaKey)&&o.code==="KeyC"&&P()}function V(o){(o.ctrlKey||o.metaKey)&&o.code==="KeyX"&&F()}function X(o){(o.ctrlKey||o.metaKey)&&o.code==="KeyV"&&I()}function $(o){if((o.ctrlKey||o.metaKey)&&o.code==="KeyZ"&&!o.shiftKey){if(N.length<=0){console.error("Error - Nothing to undo!"),S("Action Skipped - Nothing to Undo","There's nothing to Undo.");return}x(),x()}}function W(o){if(o.ctrlKey&&o.code==="KeyY"){if(G.length<=0){console.error("Error - Nothing to Redo!"),S("Action Skipped - Nothing to Rndo","There's nothing to Rndo.");return}k(),k()}}return a&&D&&(window.addEventListener("keypress",e),window.addEventListener("keydown",i),window.addEventListener("keydown",s),window.addEventListener("keyup",f),window.addEventListener("keydown",p),window.addEventListener("keydown",B),window.addEventListener("keydown",V),window.addEventListener("keydown",X),window.addEventListener("keydown",$),window.addEventListener("keydown",W)),()=>{window.removeEventListener("keypress",e),window.removeEventListener("keydown",i),window.removeEventListener("keydown",s),window.removeEventListener("keyup",f),window.removeEventListener("keydown",p),window.removeEventListener("keydown",B),window.removeEventListener("keydown",V),window.removeEventListener("keydown",X),window.removeEventListener("keydown",$),window.removeEventListener("keydown",W)}},[D,a,M,Z,y,K,g,A,P,I,x,k,N,G,F]),!se)return t.jsx(Te,{});return t.jsxs("main",{children:[t.jsx(Ie,{visibleToasts:2,position:"top-center",duration:700}),v&&t.jsx(Fe,{isOpen:!0}),t.jsxs("div",{children:[t.jsxs("div",{className:"bg-[#222222] px-4 py-4 w-full overflow-auto",children:[a?t.jsx(t.Fragment,{}):t.jsx(Y,{variant:"outline",className:" sm:hidden mb-[10px] p-6 text-lg font-normal border-white w-max",onClick:e=>{e.preventDefault(),O()},children:"Load Audio"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex justify-between space-x-4",children:[t.jsx(Le,{isAudioLoaded:a}),t.jsx(Se,{isSaving:v,isAudioLoaded:a})]}),t.jsx(ue,{})]})]}),a?t.jsx(Ne,{scrollRef:m,timelineData:L}):t.jsx(Pe,{})]})]});function O(){C(),R(),ee()}function U(){oe()}function ae(e){e.preventDefault(),U(),R(),E(!1),d.set("loopAPositionInMilis",void 0),d.set("loopAPositionInMilis",void 0),C()}function le(){var e;(e=m.current)==null||e.scrollTo({left:0,behavior:"smooth"}),b(0)}function de(){var e;(e=m.current)==null||e.scrollTo({left:l*T,behavior:"smooth"}),b(l-2)}function ce(){var e;(e=m.current)==null||e.scrollTo({left:l/2*T-window.innerWidth/2,behavior:"smooth"}),b(l/2)}function ue(){return t.jsx("div",{className:"mt-6",children:a?t.jsxs("div",{className:`flex justify-evenly items-center border mt-[-8px] rounded-lg border-white p-4 ${y?"animate-pulse":""}`,children:[t.jsx("button",{onClick:Q,title:"Zoom out timeline","aria-label":"Zoom out timeline",children:t.jsx(we,{})}),t.jsx("button",{onClick:H,title:"Zoom out timeline","aria-label":"Zoom out timeline",children:t.jsx(ye,{})}),t.jsx("button",{onClick:ce,title:"Jump to middle",children:t.jsx(ve,{})}),t.jsx("button",{onClick:le,title:"Jump to start",children:t.jsx(he,{})}),t.jsx("button",{onClick:ne,title:"Play / Pause","aria-label":"Toggle play or pause button",children:y?t.jsx(ge,{}):t.jsx(xe,{})}),t.jsx("button",{onClick:de,title:"Jump to end",children:t.jsx(ke,{})}),t.jsx("button",{onClick:U,title:"Stop","aria-label":"Stop audio button",children:t.jsx(Ee,{})}),t.jsx("button",{title:"Save audio","aria-label":"save audio button",className:`${v?"cursor-not-allowed":"cursor-pointer"}`,onClick:async e=>{e.preventDefault();const i=u[0],s=De(Ke(L,l*1e3));i&&s&&!v?(J(!0),console.log("Save started..."),await j.saveOutput(u[0],s,q).then(()=>{J(!1)})):console.error("Save file error: No input file detected or another save process is ongoing")},children:t.jsx(be,{})}),t.jsx("button",{onClick:ae,title:"Close audio","aria-label":"close audio button",children:t.jsx(je,{})})]}):t.jsx(Y,{className:"w-full py-6 text-lg font-normal hidden sm:inline-flex",onClick:e=>{e.preventDefault(),O()},children:"Load Audio"})})}}export{ze as A};
