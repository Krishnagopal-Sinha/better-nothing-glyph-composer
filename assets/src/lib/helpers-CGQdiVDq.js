import{aC as g,J as T}from"../../vendor-6J9SHA5K.js";import{d as m}from"./data_store-DFUoucx7.js";import{d as p}from"./consts-Cj2W_VlV.js";import{a as y}from"../logic/export_logic-zYbLsDjC.js";function E(t,r){const i={};return Object.keys(t).forEach(e=>{i[+e]=t[+e].filter(o=>o.startTimeMilis<r&&o.startTimeMilis+o.durationMilis>0)}),i}function $(t,r,i,e,o){const s=o??0,a=i??m.get("newBlockDurationMilis")??500,l=e??m.get("newBlockBrightness")??4095,n=[],c=Math.floor(a/p);for(let d=0;d<c;d++)n.push(y(s,l,d,c));return{id:g(),glyphId:t,startTimeMilis:r,durationMilis:a,startingBrightness:l,isSelected:!1,effectId:s,effectData:n}}function O(t){return 60*1e3/t}function w(t,r,i){return i==="right"?Math.ceil(t/r)*r:Math.floor(t/r)*r}function G(t){const r={};for(let i=0;i<Object.keys(t).length;i++)r[i]=t[i].sort((e,o)=>e.startTimeMilis-o.startTimeMilis);return r}function N(t){if(typeof t!="object"||t===null)return!1;for(const r in t){const i=t[r];if(!Array.isArray(i))return!1;for(const e of i)if(typeof e!="object"||e===null||typeof e.id!="string"||typeof e.glyphId!="number"||e.glyphId<0||typeof e.startTimeMilis!="number"||e.startTimeMilis<0||typeof e.durationMilis!="number"||e.durationMilis<0||typeof e.startingBrightness!="number"||e.startingBrightness<0||typeof e.isSelected!="boolean"||typeof e.effectId!="number"||e.effectId<0||!Array.isArray(e.effectData))return!1}return!0}function C(t,r){function i(s){const a=Math.floor(s),l=Math.floor(a/60),n=a%60,c=Math.floor((s-a)*1e3),d=String(c).padStart(3,"0").slice(0,2);if(l>0){const u=String(n).padStart(2,"0");return`${l}:${u}`}else return`${n}.${d}`}const e=i(t),o=i(r);return`${e} / ${o}`}function j(){const t=new Date(Date.now());return`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getDate().toString().padStart(2,"0")}@${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}:${t.getSeconds().toString().padStart(2,"0")}`}function b(t,r){let i,e;return function(...o){e?(clearTimeout(i),i=setTimeout(()=>{Date.now()-e>=r&&(t(...o),e=Date.now())},r-(Date.now()-e))):(t(...o),e=Date.now())}}const S=b((t,r,i)=>{T.error(t,{description:r,action:{label:"Ok",onClick:()=>{}},duration:i})},1400);function f(t,r,i){S(t,r,i)}const J=(t,r)=>{const i=t.findIndex(e=>e.startTimeMilis>r.startTimeMilis);return i===-1?[...t,r]:[...t.slice(0,i),r,...t.slice(i)]};function F(t,r,i,e=-1,o=!1){if(t.durationMilis<=0||t.startTimeMilis<0)return f("Error - Item not added","Invalid start time or duration."),!1;if(t.startTimeMilis>=i||t.startTimeMilis+t.durationMilis>i)return f("Error - Item not added or modified","Glyph timings must be within audio's time bounds."),!1;if(t.durationMilis<20)return f("Error - Item not added or modified","Glyph block duration must be least 20s!"),!1;if(r.length===0)return!0;const s=B(r,t.startTimeMilis);if(s<r.length){const a=r[s];if(s!==e&&t.startTimeMilis+t.durationMilis>a.startTimeMilis)return o||f("Error - A Block was not added or modified","New block duration exceeds or overlaps with the start time of the next block."),!1}if(s>0){const a=r[s-1];if(s-1!==e&&t.startTimeMilis<a.startTimeMilis+a.durationMilis)return o||f("Error - A Block was not added or modified","Overlap with the left neighbor Glyph block detected."),!1}if(e>=0&&e<r.length){const a=e>0?e-1:-1,l=e<r.length-1?e+1:-1;if(a>=0){const n=r[a];if(t.startTimeMilis<n.startTimeMilis+n.durationMilis)return f("Error - A Block was not added or modified","Overlap with the Glyph block on the left detected."),!1}if(l>=0){const n=r[l];if(t.startTimeMilis+t.durationMilis>n.startTimeMilis)return f("Error - A Block was not added or modified","Overlap with the Glyph block on the right detected."),!1}}return!0}function B(t,r){let i=0,e=t.length-1;for(;i<=e;){const o=Math.floor((i+e)/2);t[o].startTimeMilis<r?i=o+1:e=o-1}return i}function V(t,r,i,e=-1){if(!(t.durationMilis>0&&t.startTimeMilis>=0))return f("Error - Item not added","Invalid start time or duration."),!1;if(!(t.startTimeMilis<i&&t.startTimeMilis+t.durationMilis<=i))return f("Error - Item not added",`Glyph timings must be within audio's time bounds.
Yes, the UI might say otherwise but the audio has reached it's end`),!1;for(let o=0;o<r.length;o++){const s=r[o];if(!(e>=0&&e===o)&&t.startTimeMilis<s.startTimeMilis+s.durationMilis&&t.startTimeMilis+t.durationMilis>s.startTimeMilis)return f("Error - Item not added or modified","Overlap with another existing Glyph detected"),!1}return!0}function Y(t,r=3){const i={},e=t[0].length,o=16.66;for(let s=0;s<e;s++){i[s]=[];let a=0;for(;a<t.length;){if(t[a][s]>0){const l=a*o;let n=o;const c=[t[a][s]];let d=0;for(let h=1;h+a<t.length;h++){const M=t[a+h][s];if(M>0)c.push(M),n+=o,d=0;else if(d++,d>=r)break}const u={id:g(),glyphId:s,startTimeMilis:l,durationMilis:n,startingBrightness:t[a][s],isSelected:!1,effectId:101,effectData:c};i[s].push(u),a+=Math.floor(n/o)-1}a++}}return i}export{j as a,G as b,O as c,F as d,$ as e,w as f,C as g,V as h,J as i,Y as j,E as r,f as s,N as v};
